<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è´¦å·ç»‘å®š</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        overflow: hidden;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Microsoft YaHei", "PingFang SC", "Helvetica Neue", Arial,
          sans-serif;
      }

      body {
        background: #f5f7fa;
        display: flex;
      }

      .hub-container {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .hub-header {
        display: flex;
        justify-content: space-between;
        gap: 8px;
        padding: 20px;
        background: white;
        border-bottom: 1px solid #e9ecef;
        flex-shrink: 0;
      }

      .hub-header h1 {
        font-size: 24px;
        font-weight: 600;
        color: #333;
      }

      .hub-header p {
        font-size: 14px;
        color: #666;
      }

      .accounts-section {
        flex: 1;
        padding: 20px;
        background: #f5f7fa;
        display: flex;
        flex-direction: column;
        gap: 16px;
        overflow: hidden;
      }

      .accounts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        row-gap: 16px; /* è¡Œé—´è·ï¼ˆä¸Šä¸‹é—´è·ï¼‰*/
        column-gap: 16px; /* åˆ—é—´è·ï¼ˆå·¦å³é—´è·ï¼‰*/
        width: 100%;
        /* flex: 1; */
        overflow-y: auto;
        overflow-x: hidden;
        padding-top: 10px;
      }

      .accounts-grid::-webkit-scrollbar {
        width: 6px;
      }

      .accounts-grid::-webkit-scrollbar-track {
        background: transparent;
      }

      .accounts-grid::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 3px;
      }

      .accounts-grid::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 0, 0, 0.3);
      }

      .account-card {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 12px;
        padding: 18px;
        transition: all 0.3s ease;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        gap: 14px;
        height: fit-content;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .account-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(102, 126, 234, 0.15);
        border-color: #667eea;
      }

      .account-card-header {
        display: flex;
        align-items: flex-start;
        gap: 12px;
      }

      .account-icon {
        font-size: 32px;
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 8px;
        flex-shrink: 0;
      }

      .account-info {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 4px;
        min-width: 0;
      }

      .account-platform {
        font-size: 14px;
        font-weight: 600;
        color: #333;
        word-break: break-word;
      }

      .account-name {
        font-size: 12px;
        color: #999;
        word-break: break-word;
      }

      .account-status {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        color: #28a745;
      }

      .status-dot {
        width: 6px;
        height: 6px;
        background: #28a745;
        border-radius: 50%;
        flex-shrink: 0;
      }

      .account-actions {
        display: flex;
        gap: 8px;
        padding-top: 12px;
        border-top: 1px solid #e9ecef;
        flex-wrap: wrap;
      }

      .account-btn {
        flex: 1;
        padding: 10px 16px;
        border: none;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 70px;
      }

      .enter-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .enter-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      .delete-btn {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
      }

      .delete-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
      }

      .add-account-btn {
        padding: 14px 20px;
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        flex-shrink: 0;
        height: fit-content;
      }

      .add-account-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
      }

      .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 16px;
        padding: 40px 20px;
        text-align: center;
        background: white;
        border-radius: 12px;
        margin: 20px;
      }

      .empty-icon {
        font-size: 48px;
        opacity: 0.5;
      }

      .empty-text {
        font-size: 16px;
        color: #666;
      }

      .empty-subtext {
        font-size: 13px;
        color: #999;
      }

      @media (max-width: 768px) {
        .hub-header {
          padding: 16px;
        }

        .hub-header h1 {
          font-size: 20px;
        }

        .accounts-section {
          padding: 16px;
        }

        .accounts-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body>
    <div class="hub-container">
      <div class="hub-header">
        <div>
          <h1 id="hubTitle">è´¦å·ç®¡ç†</h1>
          <p id="hubSubtitle">ç‚¹å‡»ä¸‹æ–¹å¡ç‰‡è¿›å…¥å¯¹åº”è´¦å·å¹³å°</p>
        </div>
      </div>
      <div class="accounts-section">
        <div class="accounts-grid" id="accountsGrid"></div>
      </div>
    </div>

    <script>
      let currentMenuId = null;
      let navItems = [];
      let accounts = {};

      window.addEventListener("message", (event) => {
        console.log("[v0] hub.html received message:", event.data);
        if (event.data.type === "selectMenu") {
          currentMenuId = event.data.menuId;
          navItems = event.data.navItems || [];
          console.log(
            "[v0] selectMenu - menuId:",
            currentMenuId,
            "navItems.length:",
            navItems.length
          );
          renderAccounts();
        }
      });

      function renderAccounts() {
        console.log("[v0] renderAccounts called, menuId:", currentMenuId);
        const accountsGrid = document.getElementById("accountsGrid");

        console.log("[v0] accountsGrid element:", accountsGrid);
        console.log("[v0] accountsGrid parent:", accountsGrid?.parentElement);

        if (currentMenuId === null || currentMenuId === undefined) {
          console.log("[v0] No menuId, showing empty state");
          showEmptyState();
          return;
        }
        if (currentMenuId === 9) {
          // æ–‡å¿ƒæ™ºèƒ½ä½“çš„ID
          // ç”Ÿæˆ5ä¸ªå›ºå®šè´¦å·
          accounts[currentMenuId] = [
            {
              id: "wenxin_1",
              name: "æ–‡å¿ƒæ™ºèƒ½ä½“è´¦å·1",
              icon: "ğŸ¤–",
              status: "pending",
              menuId: 9,
            },
            {
              id: "wenxin_2",
              name: "æ–‡å¿ƒæ™ºèƒ½ä½“è´¦å·2",
              icon: "ğŸ¤–",
              status: "pending",
              menuId: 9,
            },
            {
              id: "wenxin_3",
              name: "æ–‡å¿ƒæ™ºèƒ½ä½“è´¦å·3",
              icon: "ğŸ¤–",
              status: "pending",
              menuId: 9,
            },
            {
              id: "wenxin_4",
              name: "æ–‡å¿ƒæ™ºèƒ½ä½“è´¦å·4",
              icon: "ğŸ¤–",
              status: "pending",
              menuId: 9,
            },
            {
              id: "wenxin_5",
              name: "æ–‡å¿ƒæ™ºèƒ½ä½“è´¦å·5",
              icon: "ğŸ¤–",
              status: "pending",
              menuId: 9,
            },
          ];
        }

        // æŸ¥æ‰¾å¯¹åº”çš„èœå•é¡¹
        const menuItem = navItems.find((item) => item.id === currentMenuId);
        if (!menuItem) {
          console.log("[v0] No menuItem found for menuId:", currentMenuId);
          showEmptyState();
          return;
        }

        // è·å–æˆ–åˆ›å»ºè´¦å·åˆ—è¡¨
        if (!accounts[currentMenuId]) {
          accounts[currentMenuId] = [];
          // ç¡®å®šéœ€è¦åˆ›å»ºçš„è´¦å·æ•°é‡ï¼šç™¾å®¶å·(id=1)åˆ›å»º5ä¸ªï¼Œå…¶ä»–å¹³å°åˆ›å»º1ä¸ª
          const accountCount = currentMenuId === 1 ? 5 : 1;

          // åˆ›å»ºå¯¹åº”æ•°é‡çš„æœªç»‘å®šè´¦å·
          for (let i = 1; i <= accountCount; i++) {
            accounts[currentMenuId].push({
              id: "pending_" + currentMenuId + "_" + i,
              name: menuItem.name + "è´¦å·" + i,
              icon: menuItem.icon,
              status: "pending", // æœªç»‘å®šçŠ¶æ€
              menuId: currentMenuId,
            });
          }
        }

        const menuAccounts = accounts[currentMenuId];
        console.log("[v0] Rendering", menuAccounts.length, "accounts");
        console.log("[v0] Menu accounts:", menuAccounts);

        accountsGrid.innerHTML = "";
        accountsGrid.style.display = "grid";
        console.log("[v0] accountsGrid cleared and set display to grid");

        if (menuAccounts.length > 0) {
          menuAccounts.forEach((account, index) => {
            console.log("[v0] Creating card for account", index, ":", account);
            const card = createAccountCard(account, menuItem);
            accountsGrid.appendChild(card);
            console.log(
              "[v0] Card appended, accountsGrid children:",
              accountsGrid.children.length
            );
          });
        } else {
          console.log("[v0] No accounts, showing empty state");
          showEmptyState();
        }

        console.log(
          "[v0] renderAccounts finished, final grid children count:",
          accountsGrid.children.length
        );
      }

      function createAccountCard(account, menuItem) {
        const card = document.createElement("div");
        card.className = "account-card";

        // å¡ç‰‡å¤´éƒ¨
        const headerDiv = document.createElement("div");
        headerDiv.className = "account-card-header";

        const iconDiv = document.createElement("div");
        iconDiv.className = "account-icon";
        iconDiv.textContent = menuItem.icon;

        const infoDiv = document.createElement("div");
        infoDiv.className = "account-info";

        const platformName = document.createElement("div");
        platformName.className = "account-platform";
        platformName.textContent = account.name;

        const accountDesc = document.createElement("div");
        accountDesc.className = "account-name";
        accountDesc.textContent = "è´¦å·ç»‘å®šä¿¡æ¯";

        infoDiv.appendChild(platformName);
        infoDiv.appendChild(accountDesc);
        headerDiv.appendChild(iconDiv);
        headerDiv.appendChild(infoDiv);

        // çŠ¶æ€
        const statusDiv = document.createElement("div");
        statusDiv.className = "account-status";
        const statusDot = document.createElement("div");
        statusDot.className = "status-dot";
        const statusText = document.createElement("span");
        statusText.textContent = "å·²æ¿€æ´»";
        statusDiv.appendChild(statusDot);
        statusDiv.appendChild(statusText);

        // æ“ä½œæŒ‰é’®
        const actionsDiv = document.createElement("div");
        actionsDiv.className = "account-actions";

        const enterBtn = document.createElement("button");
        enterBtn.className = "account-btn enter-btn";
        // æ ¹æ®è´¦å·çŠ¶æ€æ˜¾ç¤ºä¸åŒæ–‡æœ¬
        enterBtn.textContent = account.status === "pending" ? "å»æˆæƒ" : "è¿›å…¥";
        enterBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          console.log("[v0] enterWebview clicked for account:", account);

          // æ–‡å¿ƒæ™ºèƒ½ä½“è´¦å·ç‰¹æ®Šå¤„ç†
          if (account.menuId === 9) {
            // å‘é€æ¶ˆæ¯ç»™ä¸»çª—å£ï¼Œè¦æ±‚æ‰“å¼€æ–°çª—å£
            window.parent.postMessage(
              {
                type: "openWenxinAuth",
                accountId: account.id,
                url: "https://agents.baidu.com/center",
              },
              "*"
            );
          } else {
            window.parent.postMessage(
              {
                type: "enterWebview",
                menuId: account.menuId,
                accountId: account.id,
              },
              "*"
            );
          }
        });

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "account-btn delete-btn";
        deleteBtn.textContent = "åˆ é™¤";
        deleteBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          deleteAccount(account.id);
        });

        actionsDiv.appendChild(enterBtn);
        actionsDiv.appendChild(deleteBtn);

        card.appendChild(headerDiv);
        card.appendChild(statusDiv);
        card.appendChild(actionsDiv);

        return card;
      }

      function showEmptyState() {
        const accountsGrid = document.getElementById("accountsGrid");
        console.log("[v0] showEmptyState called");
        accountsGrid.innerHTML = `
                <div style="grid-column: 1/-1;">
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“­</div>
                        <div class="empty-text">æš‚æ— è´¦å·ä¿¡æ¯</div>
                        <div class="empty-subtext">ç‚¹å‡»ä¸‹æ–¹"æ·»åŠ è´¦å·"æŒ‰é’®ç»‘å®šæ–°è´¦å·</div>
                    </div>
                </div>
            `;
      }

      function deleteAccount(accountId) {
        if (!confirm("ç¡®å®šè¦åˆ é™¤æ­¤è´¦å·å—ï¼Ÿ")) return;
        if (accounts[currentMenuId]) {
          accounts[currentMenuId] = accounts[currentMenuId].filter(
            (acc) => acc.id !== accountId
          );
          renderAccounts();
        }
      }

      // function addAccount() {
      //     if (currentMenuId === null || currentMenuId === undefined) {
      //         alert('è¯·å…ˆä»å·¦ä¾§èœå•é€‰æ‹©å¹³å°');
      //         return;
      //     }

      //     if (!accounts[currentMenuId]) {
      //         accounts[currentMenuId] = [];
      //     }

      //     const menuItem = navItems.find(item => item.id === currentMenuId);
      //     if (!menuItem) return;

      //     const newAccount = {
      //         id: 'account_' + Date.now(),
      //         name: menuItem.name + 'è´¦å·' + (accounts[currentMenuId].length + 1),
      //         icon: menuItem.icon,
      //         status: 'active',
      //         menuId: currentMenuId
      //     };

      //     accounts[currentMenuId].push(newAccount);
      //     renderAccounts();

      //     // é€šçŸ¥ä¸»çª—å£éœ€è¦è¿›è¡Œè´¦å·ç»‘å®š
      //     window.parent.postMessage({
      //         type: 'addNewAccount',
      //         menuId: currentMenuId,
      //         accountId: newAccount.id
      //     }, '*');
      // }

      function addAccount() {
        if (currentMenuId === null || currentMenuId === undefined) {
          alert("è¯·å…ˆä»å·¦ä¾§èœå•é€‰æ‹©å¹³å°");
          return;
        }

        // ç›´æ¥å‘é€æ¶ˆæ¯ç»™çˆ¶çª—å£ï¼Œè¿›å…¥å¯¹åº”çš„webviewé¡µé¢è¿›è¡Œè´¦å·ç»‘å®š
        window.parent.postMessage(
          {
            type: "enterWebview",
            menuId: currentMenuId,
          },
          "*"
        );

        const menuItem = navItems.find((item) => item.id === currentMenuId);
        if (!menuItem) return;

        const newAccount = {
          id: "temp_" + Date.now(),
          name: menuItem.name + "æ–°è´¦å·",
          icon: menuItem.icon,
          status: "pending",
          menuId: currentMenuId,
        };

        // å¯ä»¥æš‚æ—¶å­˜å‚¨è¿™ä¸ªè´¦å·ä¿¡æ¯ï¼Œç­‰å¾…ç»‘å®šå®Œæˆåå†æ­£å¼æ·»åŠ 
        // è¿™é‡Œæˆ‘ä»¬å…ˆæ³¨é‡Šæ‰ä¹‹å‰çš„é€»è¾‘ï¼Œç›´æ¥è·³è½¬
      }
      showEmptyState();
    </script>
  </body>
</html>
