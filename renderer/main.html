<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÊéàÊùÉÂ∑•ÂÖ∑</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Microsoft YaHei", "PingFang SC", "Helvetica Neue", Arial,
          sans-serif;
      }

      body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
        color: #333;
      }

      #app {
        display: flex;
        flex: 1;
        overflow: hidden;
        position: relative;
        height: 100vh;
      }

      /* Â∑¶‰æßÂØºËà™Ê†∑Âºè */
      .sidebar {
        width: 300px;
        background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
        z-index: 10;
        position: relative;
      }

      .sidebar::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3Cpattern id='grain' width='100' height='100' patternUnits='userSpaceOnUse'%3E%3Ccircle cx='50' cy='50' r='1' fill='rgba(255,255,255,0.05)'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100' height='100' fill='url(%23grain)'/%3E%3C/svg%3E");
        pointer-events: none;
      }

      .drag-area {
        width: 100%;
        height: 30px;
        cursor: grab;
        -webkit-app-region: drag;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 100;
      }

      .nav-header {
        padding: 40px 20px 20px 20px;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 20px;
      }

      .nav-header h2 {
        color: white;
        font-size: 22px;
        font-weight: 600;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
      }

      .nav-header h2::before {
        margin-right: 12px;
        font-size: 24px;
      }

      .nav-items {
        padding: 25px 20px;
        flex: 1;
        overflow-y: auto;
        position: relative;
        z-index: 1;
      }

      .nav-items::-webkit-scrollbar {
        width: 6px;
      }

      .nav-items::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
      }

      .nav-items::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 3px;
      }

      .nav-items::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.5);
      }

      .nav-item {
        display: flex;
        align-items: center;
        padding: 18px 24px;
        margin: 8px 0;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        color: rgba(255, 255, 255, 0.8);
        font-size: 15px;
        font-weight: 500;
        position: relative;
        overflow: hidden;
      }

      .nav-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transition: left 0.5s;
      }

      .nav-item:hover::before {
        left: 100%;
      }

      .nav-item:hover {
        background: rgba(255, 255, 255, 0.15);
        color: white;
        transform: translateX(5px);
      }

      .nav-item.active {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transform: translateX(5px);
      }

      .nav-item.active::after {
        content: "";
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 4px;
        height: 60%;
        background: white;
        border-radius: 2px 0 0 2px;
      }

      .nav-item span:first-child {
        margin-right: 15px;
        font-size: 20px;
        width: 24px;
        text-align: center;
      }

      .nav-item span.menu-text {
        flex: 1;
        text-align: left;
      }

      .arrow-container {
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.3s ease;
      }

      .submenu-arrow {
        font-size: 12px;
        transition: transform 0.3s ease;
      }

      .arrow-container.open .submenu-arrow {
        transform: rotate(90deg);
      }

      /* Âè≥‰æßÂÜÖÂÆπÂÆπÂô®ÔºåÁî®‰∫éÂàáÊç¢hubÂíåwebview */
      .content-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        background: white;
        border-radius: 20px 0 0 0;
        box-shadow: -4px 0 20px rgba(0, 0, 0, 0.05);
        position: relative;
        height: 100vh;
      }

      .content-area::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(102, 126, 234, 0.2),
          transparent
        );
      }

      .browser-controls {
        padding: 20px 25px;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-top: 1px solid #dee2e6;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
      }

      .browser-controls::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(102, 126, 234, 0.1),
          transparent
        );
      }

      .control-group {
        display: flex;
        gap: 16px;
        align-items: center;
        flex-wrap: wrap;
      }

      .refresh-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 8px;
        color: white;
        font-size: 13px;
        font-weight: 500;
        padding: 12px 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        min-width: 100px;
      }

      .refresh-btn::before {
        content: "üîÑ";
        font-size: 14px;
      }

      .refresh-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .refresh-btn:active {
        transform: translateY(0);
      }

      .update-auth-btn {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        border: none;
        border-radius: 8px;
        color: white;
        font-size: 13px;
        font-weight: 500;
        padding: 12px 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        box-shadow: 0 2px 8px rgba(40, 167, 69, 0.2);
        min-width: 100px;
      }

      .update-auth-btn::before {
        content: "üîÑ";
        font-size: 14px;
      }

      .update-auth-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
      }

      .update-auth-btn:active {
        transform: translateY(0);
      }

      .logout-btn {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 12px 20px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 500;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        box-shadow: 0 2px 8px rgba(231, 76, 60, 0.2);
        min-width: 100px;
      }

      .logout-btn::before {
        content: "üö™";
        font-size: 14px;
      }

      .logout-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
      }

      .logout-btn:active {
        transform: translateY(0);
      }

      .status-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        color: #666;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #28a745;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }

        50% {
          opacity: 0.5;
        }

        100% {
          opacity: 1;
        }
      }

      .message-box {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        padding: 40px;
        text-align: center;
        min-width: 350px;
        z-index: 1000;
        border: 1px solid rgba(102, 126, 234, 0.1);
        backdrop-filter: blur(10px);
      }

      .message-box h3 {
        color: #667eea;
        margin-bottom: 15px;
        font-size: 20px;
        font-weight: 600;
      }

      .message-box p {
        color: #666;
        margin-bottom: 25px;
        font-size: 15px;
        line-height: 1.5;
      }

      .message-box button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 12px 24px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .message-box button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 100;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .loading-overlay.show {
        opacity: 1;
        visibility: visible;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 768px) {
        .sidebar {
          width: 250px;
        }

        .nav-header h2 {
          font-size: 18px;
        }

        .nav-item {
          padding: 15px 20px;
          font-size: 14px;
        }

        .browser-controls {
          padding: 15px 20px;
          flex-direction: column;
          gap: 15px;
        }

        .control-group {
          justify-content: center;
          gap: 12px;
        }

        .refresh-btn,
        .update-auth-btn,
        .logout-btn {
          padding: 10px 16px;
          font-size: 12px;
          min-width: 90px;
        }
      }

      .nav-item {
        animation: slideInLeft 0.5s ease-out;
      }

      @keyframes slideInLeft {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }

        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .content-area {
        animation: slideInRight 0.5s ease-out;
      }

      @keyframes slideInRight {
        from {
          opacity: 0;
          transform: translateX(20px);
        }

        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .version-info {
        margin: 20px 20px 15px 20px;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.6);
        padding: 12px 16px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 8px;
        font-weight: 500;
        letter-spacing: 0.5px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(5px);
        text-align: center;
        position: relative;
        z-index: 1;
      }

      /* ‰øÆÂ§çÂêéÁöÑ view-container Ê†∑Âºè */
      .view-container {
        flex: 1;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        /* height: calc(100vh - 80px); ÂáèÂéªÂ∫ïÈÉ®ÊéßÂà∂Ê†èÈ´òÂ∫¶ */
      }

      #hubFrame {
        width: 100%;
        height: 100%;
        border: none;
        display: none;
      }

      #hubFrame.active {
        display: block;
      }

      webview {
        width: 100%;
        height: 100%;
        display: none;
      }
      #hubFrame,
      webview {
        width: 100%;
        height: 100%;
        border: none;
        position: absolute;
        top: 0;
        left: 0;
        z-index: -1;
      }
      #hubFrame.active,
      webview.active {
        height: 100%;
        display: block;
        z-index: 1;
      }

      iframe {
        width: 100%;
        height: 100% !important;
        border: none;
      }
    </style>
  </head>

  <body>
    <div id="app">
      <div class="sidebar">
        <div class="drag-area" id="dragArea"></div>
        <div class="nav-header">
          <h2 id="userNameHeader">Âπ≥Âè∞ÂØºËà™</h2>
        </div>
        <div class="nav-items" id="navItems"></div>
        <div class="version-info" id="versionInfo">v1.0.0</div>
        <div class="browser-controls">
          <div class="control-group">
            <button class="refresh-btn" id="refreshBtn">Âà∑Êñ∞È°µÈù¢</button>
            <button class="update-auth-btn" id="updateAuthBtn">Êõ¥Êñ∞ÊéàÊùÉ</button>
          </div>
          <div class="control-group">
            <button class="logout-btn" id="logoutBtn">ÈÄÄÂá∫ÁôªÂΩï</button>
          </div>
        </div>
      </div>
      <div class="content-area">
        <div class="view-container">
          <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
          </div>
          <!-- ‰ΩøÁî®iframeÂä†ËΩΩhubÈ°µÈù¢ÔºåÂàùÂßãÊòæÁ§∫‰∏ªÈ°µ webview -->
          <iframe
		  	style="display:inline-flex; width:100%; height:100%"
            id="hubFrame"
            src="./hub.html"
            allow="camera;microphone"
          ></iframe>
          <!-- Âè≥‰æß webview ÂÆπÂô® -->
          <webview
            id="browserView"
			style="display:inline-flex; width:100%; height:100%"
            partition="persist:zhongshang"
            disablewebsecurity
            webpreferences="javascript=yes, contextIsolation=yes"
            allowpopups
            useragent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"
          >
          </webview>
        </div>
      </div>
    </div>

    <script src="./main.js"></script>
    <script>
      const userAgents = [
        "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36",
        "Mozilla/5.0 (Macintosh; Intel Mac OS X 13_4) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.4 Safari/605.1.15",
        "Mozilla/5.0 (iPhone; CPU iPhone OS 16_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.4 Mobile/15E148 Safari/604.1",
        "Mozilla/5.0 (Linux; Android 13; SM-S901U) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Mobile Safari/537.36",
      ];

      function getRandomUserAgent() {
        return userAgents[Math.floor(Math.random() * userAgents.length)];
      }

      const navItems = [
        {
          id: 0,
          name: "‰∏ªÈ°µ",
          url: "./welcome.html",
          icon: "üè†",
          flag: false,
          show: true,
        },
        {
          id: 1,
          name: "ÁôæÂÆ∂Âè∑",
          url: "https://baijiahao.baidu.com/",
          icon: "üìù",
          flag: false,
          show: true,
        },
        {
          id: 2,
          name: "ÊêúÁãê",
          url: "https://mp.sohu.com/mpfe/v4/login",
          icon: "ü¶ä",
          flag: false,
          show: true,
        },
        {
          id: 6,
          name: "ËÖæËÆØÂàõ‰Ωú",
          url: "https://om.qq.com/main",
          icon: "üêß",
          flag: false,
          show: true,
        },
        {
          id: 4,
          name: "ÂæÆ‰ø°ÂÖ¨‰ºóÂè∑",
          url: "http://zs.open.chuangmaedu.com/openPlatform/preAuthCodeHtml/open?id=",
          icon: "üí¨",
          flag: false,
          show: true,
        },
        {
          id: 3,
          name: "‰ªäÊó•Â§¥Êù°",
          url: "https://mp.toutiao.com/auth/page/login",
          icon: "üì∞",
          flag: false,
          show: false,
        },
        {
          id: 5,
          name: "Êñ∞Êµ™",
          url: "https://mp.sina.com.cn/",
          icon: "üïäÔ∏è",
          flag: false,
          show: false,
        },
        {
          id: 8,
          name: "ÁΩëÊòì",
          url: "https://mp.163.com/login.html#/",
          icon: "üåê",
          flag: false,
          show: false,
        },
      ];

      let token = "";
      let sendId = "";
      let currentNavId = 0;
      let sendFlag = false;
      let userName = "";
      let cookiesList = [];
      let currentViewMode = "home"; // ÂàùÂßãÂåñ‰∏∫‰∏ªÈ°µÊ®°Âºè

      window.electronAPI.setUserData((event, data) => {
        token = data.token;
        sendId = data.sendId;
        userName = data.userName;
        console.log("=======userName", userName);
        const userNameHeader = document.getElementById("userNameHeader");
        if (userNameHeader && userName) {
          userNameHeader.textContent = userName;
        }
        window.electronAPI
          .getMenuIsAuth({
            id: sendId,
            _type: "zmt_wy",
          })
          .then((result) => {
            console.log("render_ÊùÉÈôêË∞ÉÁî®ÁªìÊûú:", result);
            navItems.forEach((item) => {
              if (result.hasOwnProperty(item.id) && result[item.id]) {
                item.show = result[item.id];
              }
            });
            initApp();
          })
          .catch((error) => {
            console.error("ÊùÉÈôêË∞ÉÁî®Â§±Ë¥•:", error);
            initApp();
          });
      });

      function initDragAndDrop() {
        const dragArea = document.getElementById("dragArea");
        let isDragging = false;
        let startX, startY;

        dragArea.addEventListener("mousedown", (e) => {
          isDragging = true;
          startX = e.clientX;
          startY = e.clientY;
          dragArea.style.cursor = "grabbing";
        });

        document.addEventListener("mousemove", (e) => {
          if (!isDragging) return;
          const deltaX = e.clientX - startX;
          const deltaY = e.clientY - startY;
          window.electronAPI.moveWindow({ deltaX, deltaY });
        });

        document.addEventListener("mouseup", () => {
          isDragging = false;
          dragArea.style.cursor = "grab";
        });
      }

      function initApp() {
        initDragAndDrop();
        cookiesList = [];
        const navItemsCo = document.getElementById("navItems");
        const versionInfo = document.getElementById("versionInfo");
        const params = new URLSearchParams(window.location.search);
        const version = params.get("version");
        if (version) {
          versionInfo.textContent = `¬© 2025 ÊéàÊùÉÂ∑•ÂÖ∑ v${version}`;
        }

        navItems.forEach((item, index) => {
          if (item.id != 5 && item.id != 3 && item.show) {
            const navItem = document.createElement("div");
            navItem.className = "nav-item";
            if (item.id === currentNavId) navItem.classList.add("active");
            navItem.dataset.id = item.id;
            navItem.style.animationDelay = `${index * 0.1}s`;

            if (item.id === 1) {
              navItem.innerHTML = `
                            <span>${item.icon}</span>
                            <span class="menu-text">${item.name}</span>
                            <div class="arrow-container" id="arrowContainer">
                                <span class="submenu-arrow">‚ñ∂</span>
                            </div>
                        `;
            } else {
              navItem.innerHTML = `
                            <span>${item.icon}</span>
                            <span class="menu-text">${item.name}</span>
                        `;
            }

            navItem.addEventListener("click", (e) => {
              if (
                e.target.classList.contains("submenu-arrow") ||
                e.target.parentElement.classList.contains("arrow-container")
              ) {
                e.stopPropagation();
                const subMenu = document.getElementById("wenxinSubMenu");
                const arrowContainer =
                  document.getElementById("arrowContainer");

                if (
                  subMenu.style.display === "none" ||
                  !subMenu.style.display
                ) {
                  subMenu.style.display = "flex";
                  arrowContainer.classList.add("open");
                } else {
                  subMenu.style.display = "none";
                  arrowContainer.classList.remove("open");
                }
                return;
              }

              document
                .querySelector(".nav-item.active")
                .classList.remove("active");
              navItem.classList.add("active");
              currentNavId = item.id;

              const hubFrame = document.getElementById("hubFrame");
              const webview = document.getElementById("browserView");

              if (item.id === 0) {
                // ‰∏ªÈ°µÔºöÊòæÁ§∫ÂéüÊù•ÁöÑ webview
                currentViewMode = "home";
                webview.classList.add("active");
                hubFrame.classList.remove("active");
                console.log(
                  "[v0] Switched to HOME - webview.active:",
                  webview.classList.contains("active"),
                  "hubFrame.active:",
                  hubFrame.classList.contains("active")
                );
                webview.src = item.url;
              } else {
                // ÂÖ∂‰ªñËèúÂçïÔºöÊòæÁ§∫hub‰∏≠ËΩ¨È°µÈù¢
                currentViewMode = "hub";
                hubFrame.classList.add("active");
                webview.classList.remove("active");
                console.log(
                  "[v0] Switched to HUB - webview.active:",
                  webview.classList.contains("active"),
                  "hubFrame.active:",
                  hubFrame.classList.contains("active")
                );

                setTimeout(() => {
                  console.log(
                    "[v0] Sending selectMenu to hub, menuId:",
                    item.id,
                    "navItems:",
                    navItems
                  );
                  const hubContent = hubFrame.contentWindow;
                  if (hubContent) {
                    hubContent.postMessage(
                      {
                        type: "selectMenu",
                        menuId: item.id,
                        navItems: navItems,
                        userData: {sendId: sendId}
                      },
                      "*"
                    );
                  }
                }, 300);
              }

              cookiesList = [];
            });

            navItemsCo.appendChild(navItem);

            if (item.id === 1) {
              const subMenu = document.createElement("div");
              subMenu.className = "nav-item";
              subMenu.id = "wenxinSubMenu";
              subMenu.style.paddingLeft = "48px";
              subMenu.style.fontSize = "14px";
              subMenu.style.opacity = "0.85";
              subMenu.style.display = "none";
              subMenu.innerHTML = `<span>ü§ñ</span><span class="menu-text">ÊñáÂøÉÊô∫ËÉΩ‰Ωì</span>`;
             // ‰øÆÊîπ renderer/main.html ‰∏≠ÂÖ≥‰∫éÊñáÂøÉÊô∫ËÉΩ‰ΩìÁöÑÁÇπÂáª‰∫ã‰ª∂
              subMenu.addEventListener("click", async () => {
                document.querySelector(".nav-item.active").classList.remove("active");
                subMenu.classList.add("active");
                
                // ÂàáÊç¢Âà∞Ë¥¶Âè∑ÁÆ°ÁêÜËßÜÂõæ
                currentViewMode = "hub";
                currentNavId = 9; // ‰∏∫ÊñáÂøÉÊô∫ËÉΩ‰ΩìÂàÜÈÖç‰∏Ä‰∏™Êñ∞ÁöÑID
                const hubFrame = document.getElementById("hubFrame");
                const webview = document.getElementById("browserView");
                
                hubFrame.classList.add("active");
                webview.classList.remove("active");
                
                // ÈÄöÁü•hubÈ°µÈù¢ÂàáÊç¢Âà∞ÊñáÂøÉÊô∫ËÉΩ‰ΩìË¥¶Âè∑ÁÆ°ÁêÜ
                hubFrame.contentWindow.postMessage({
                  type: "selectMenu",
                  menuId: 9,
                  navItems: [...navItems, {
                    id: 9,
                    name: "ÊñáÂøÉÊô∫ËÉΩ‰Ωì",
                    url: "https://agents.baidu.com/center",
                    icon: "ü§ñ",
                    flag: false,
                    show: true
                  }],
                  userData: {sendId: sendId}
                }, "*");
                // hubFrame.contentWindow.postMessage({
                //   type: "selectMenu",
                //   menuId: item.id,
                //   navItems: navItems,
                //   userData: {sendId: sendId}  // Á°Æ‰øùËøôÈáåÁöÑ sendId ÊòØÊ≠£Á°ÆÁöÑÂΩìÂâçÁî®Êà∑ID
                // }, "*");
              });
              navItemsCo.appendChild(subMenu);
            }
          }
        });

        // ÂàùÂßãÊòæÁ§∫‰∏ªÈ°µ
        const homeNavItem = navItems.find((item) => item.id === 0);
        if (homeNavItem) {
          currentNavId = 0;
          currentViewMode = "home";
          const webview = document.getElementById("browserView");
          const hubFrame = document.getElementById("hubFrame");
          webview.classList.add("active");
          hubFrame.classList.remove("active");
          webview.src = homeNavItem.url;

          // Ê†áËÆ∞‰∏ªÈ°µËèúÂçï‰∏∫Ê¥ªË∑ÉÁä∂ÊÄÅ
          const homeMenuItem = navItemsCo.querySelector('[data-id="0"]');
          if (homeMenuItem) {
            homeMenuItem.classList.add("active");
          }
        }
      }

      document.getElementById("refreshBtn").addEventListener("click", () => {
        const webview = document.getElementById("browserView");
        showLoading();
        if (currentViewMode === "hub") {
          hideLoading();
          return;
        }
        if (currentNavId === 8 || currentNavId === 4) {
          const a = navItems.find((item) => item.id === currentNavId);
          webview.src = a.url + sendId;
        } else {
          webview.reload();
        }
      });

      document.getElementById("updateAuthBtn").addEventListener("click", () => {
        if (currentViewMode === "hub") {
          showSuccessMessage("ËØ∑ÂÖàÈÄâÊã©Ë¥¶Âè∑ËøõÂÖ•ÁºñËæë");
          return;
        }
        updateAuthorization();
      });

      document.getElementById("logoutBtn").addEventListener("click", () => {
        window.electronAPI.logout();
      });

      const webview = document.getElementById("browserView");

      webview.addEventListener("did-start-loading", () => {
        showLoading();
      });

      webview.addEventListener("did-stop-loading", () => {
        hideLoading();
      });

      webview.addEventListener("did-finish-load", async () => {
        webview.executeJavaScript(`
				// Êü•ÊâæÁõÆÊ†áiframeÔºàÊ†πÊçÆÂÆûÈôÖÊÉÖÂÜµ‰øÆÊîπÈÄâÊã©Âô®Ôºâ
				const targetIframe = document.querySelector('iframe'); // ÊõøÊç¢‰∏∫ÂÆûÈôÖÁöÑiframeÈÄâÊã©Âô®
				
				if (targetIframe) {
				// Á≠âÂæÖiframeÂä†ËΩΩÂÆåÊàê
				targetIframe.addEventListener('load', () => {
					try {
					// Ëé∑ÂèñiframeÁöÑÊñáÊ°£ÂØπË±°
					const iframeDoc = targetIframe.contentDocument || targetIframe.contentWindow.document;
					
					// Êü•Êâæshadow rootÔºàÊ†πÊçÆÂÆûÈôÖÊÉÖÂÜµ‰øÆÊîπÈÄâÊã©Âô®Ôºâ
					const shadowHost = iframeDoc.querySelector('#shadowHost'); // ÊõøÊç¢‰∏∫ÂÆûÈôÖÁöÑshadowÂÆø‰∏ªÈÄâÊã©Âô®
					if (shadowHost && shadowHost.shadowRoot) {
						const shadowRoot = shadowHost.shadowRoot;
						
						// ÂàõÂª∫Ê†∑ÂºèÂÖÉÁ¥†Âπ∂Ê∑ªÂä†Ê†∑ÂºèËßÑÂàô
						const style = document.createElement('style');
						style.textContent = \`
						/* Âú®ËøôÈáåÊ∑ªÂä†‰Ω†ÁöÑÊ†∑ÂºèËßÑÂàô */
						.some-class { color: red; }
						#some-id { background: blue; }
						body { font-size: 14px; }
						\`;
						
						// Â∞ÜÊ†∑ÂºèÊ∑ªÂä†Âà∞shadow root
						shadowRoot.appendChild(style);
						
						console.log('Ê†∑ÂºèÂ∑≤ÊàêÂäüÊ≥®ÂÖ•Âà∞shadow DOM');
					} else {
						console.log('Êú™ÊâæÂà∞shadow root');
					}
					} catch (e) {
					console.error('‰øÆÊîπÊ†∑ÂºèÊó∂Âá∫Èîô:', e);
					}
				});
				} else {
				console.log('Êú™ÊâæÂà∞ÁõÆÊ†áiframe');
				}
			`);
        hideLoading();
        const currentUrl = webview.getURL();
        const url = new URL(currentUrl);
        console.log("renderer_ÂΩìÂâçÁΩëÂùÄ:", url);
        if (
          currentUrl.includes("https://mp.toutiao.com/profile_v4/index") ||
          "/profile_v4/index".includes(currentUrl)
        ) {
          checkLoginStatus(currentUrl);
        }
        if (
          currentUrl.includes(
            "http://zs.open.chuangmaedu.com/openPlatform/callback"
          )
        ) {
          checkLoginStatus(currentUrl);
        }
        if (
          currentUrl.includes("https://post.smzdm.com/tougao") &&
          !currentUrl.includes("login")
        ) {
          checkLoginStatus(currentUrl);
        }
        if (currentUrl.includes("https://om.qq.com/main")) {
          checkLoginStatus(currentUrl);
        }
      });

      webview.addEventListener("did-fail-load", (event) => {
      const { errorCode, errorDescription, validatedURL } = event;
      // ÂøΩÁï•‰∏Ä‰∫õÂ∏∏ËßÅÁöÑÈùûÂÖ≥ÈîÆÈîôËØØÁ†ÅÔºåÈÅøÂÖçÊó•ÂøóÂà∑Â±è
      if (errorCode !== -3 && errorCode !== -27) {
        console.error(
          `WebviewÂä†ËΩΩÂ§±Ë¥•: ${errorCode} - ${errorDescription} - URL: ${validatedURL}`
        );
      }
      // ÈöêËóèÂä†ËΩΩÂä®Áîª
      hideLoading();
      });

      webview.addEventListener("did-navigate-in-page", (event) => {
        console.log(event);
        const currentUrl = event.url || webview.getURL();
        console.log("È°µÈù¢ÂÜÖURLÂèòÂåñ:", currentUrl);
        checkLoginStatus(currentUrl);
      });

      window.addEventListener("message", (event) => {
        if (event.data.type === "enterWebview") {
          // Êù•Ëá™hubÈ°µÈù¢ÔºöÁî®Êà∑ÁÇπÂáª‰∫ÜË¥¶Âè∑Âç°ÁâáÔºåËøõÂÖ•webview
          currentViewMode = "webview";
          const hubFrame = document.getElementById("hubFrame");
          const containerView = document.querySelector('.view-container');
          

          // Ëé∑ÂèñÈ¢ùÂ§ñÂèÇÊï∞
          const isMain = event.data.isMain || 0;
          const position = event.data.position || 1;

          // Â∞ÜpositionÂíåisMainÂèÇÊï∞‰øùÂ≠òÂà∞windowÂØπË±°‰∏≠Ôºå‰ª•‰æøÂú®checkLoginStatusÂáΩÊï∞‰∏≠‰ΩøÁî®
          window.currentAccountPosition = position;
          window.currentAccountIsMain = isMain;
          console.log(`ÂΩìÂâçË¥¶Âè∑‰ΩçÁΩÆ: ${position}, isMain: ${isMain}`);
          // window.currentAccountId = accountId;
          // ‰øùÂ≠òaccountIdÂà∞webviewÁöÑdataÂ±ûÊÄß‰∏≠Ôºå‰ª•‰æøÂêéÁª≠Ëé∑Âèñ
          // newWebview.setAttribute('data-account-id', accountId);
          // ÁßªÈô§ÊóßÁöÑ webview
          const oldWebview = document.getElementById("browserView");
          if (oldWebview) {
            oldWebview.remove();
          }
          
          // ÂàõÂª∫Êñ∞ÁöÑ webview Âπ∂ËÆæÁΩÆÁã¨Á´ãÂàÜÂå∫
          const newWebview = document.createElement('webview');
          newWebview.id = "browserView";
          newWebview.style.cssText = "display:inline-flex; width:100%; height:100%";
          // ‰∏∫‰∏çÂêåË¥¶Âè∑ÂàõÂª∫Áã¨Á´ãÁöÑÂàÜÂå∫
          newWebview.partition = `persist:account_${event.data.accountId}`;
          newWebview.setAttribute('data-account-id', event.data.accountId);
          newWebview.setAttribute("disablewebsecurity", "");
          newWebview.setAttribute("webpreferences", "javascript=yes, contextIsolation=yes");
          newWebview.setAttribute("allowpopups", "");
          newWebview.setAttribute("useragent", "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36");
          
          // Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
          newWebview.addEventListener("did-start-loading", () => {
            showLoading();
          });
          
          newWebview.addEventListener("did-stop-loading", () => {
            hideLoading();
          });
          
          newWebview.addEventListener("did-finish-load", async () => {
            hideLoading();
            const currentUrl = newWebview.getURL();
            if (
              currentUrl.includes("https://mp.toutiao.com/profile_v4/index") ||
              "/profile_v4/index".includes(currentUrl)
            ) {
              checkLoginStatus(currentUrl);
            }
            if (
              currentUrl.includes(
                "http://zs.open.chuangmaedu.com/openPlatform/callback"
              )
            ) {
              checkLoginStatus(currentUrl);
            }
            if (
              currentUrl.includes("https://post.smzdm.com/tougao") &&
              !currentUrl.includes("login")
            ) {
              checkLoginStatus(currentUrl);
            }
            if (currentUrl.includes("https://om.qq.com/main")) {
              checkLoginStatus(currentUrl);
            }
          });
          
          newWebview.addEventListener("did-navigate-in-page", (event) => {
            const currentUrl = event.url || newWebview.getURL();
            checkLoginStatus(currentUrl);
          });

          // Ê∑ªÂä†Âà∞ÂÆπÂô®‰∏≠
          containerView.appendChild(newWebview);

          hubFrame.classList.remove("active");
          newWebview.classList.add("active");

          // ‰ªénavItems‰∏≠Ëé∑ÂèñÂØπÂ∫îÁöÑurl
          const menuItem = navItems.find(
            (item) => item.id === event.data.menuId
          );
          
          if (menuItem) {
            // Ëé∑ÂèñÁõÆÊ†áURL
            let targetUrl;
            if (event.data.menuId === 4) {
              targetUrl = menuItem.url + sendId;
            } else if (event.data.menuId === 8) {
              targetUrl = menuItem.url + sendId;
            } else {
              targetUrl = menuItem.url;
            }
            
            // ÂÆûÁé∞Êõ¥ÂÅ•Â£ÆÁöÑcookieÊ≥®ÂÖ•ÈÄªËæëÔºåÂ§ÑÁêÜÂ§çÊùÇÁöÑËΩ¨‰πâÂ≠óÁ¨¶ÂíåJSONÊ†ºÂºèÈóÆÈ¢ò
            let cookiePromise;
            
            // 1. È¶ñÂÖàÂ∞ùËØï‰ΩøÁî®event.data.cookiesÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
            if (event.data.cookies) {
                cookiePromise = new Promise((resolve, reject) => {
                    try {
                        let cookiesList;
                        if (typeof event.data.cookies === 'string') {
                            console.log('Â§ÑÁêÜÂ≠óÁ¨¶‰∏≤Ê†ºÂºèÁöÑcookiesÊï∞ÊçÆ');
                            
                            // ÁßªÈô§Â§ñÈÉ®ÂºïÂè∑
                            let cookieStr = event.data.cookies.replace(/^"|"$/g, '');
                            
                            // Â§ÑÁêÜËΩ¨‰πâÂ≠óÁ¨¶ - Êõ¥ÂÖ®Èù¢ÁöÑËΩ¨‰πâÂ§ÑÁêÜ
                            cookieStr = cookieStr.replace(/\\\\"/g, '\\"'); // Â§ÑÁêÜÂèåÈáçËΩ¨‰πâ
                            cookieStr = cookieStr.replace(/\\"/g, '"'); // Â§ÑÁêÜËΩ¨‰πâÂºïÂè∑
                            
                            // Â∞ùËØïÊâæÂà∞ÊúâÊïàÁöÑJSONÁªìÊùü‰ΩçÁΩÆÔºàÂ§ÑÁêÜÂèØËÉΩÁöÑÊà™Êñ≠Ôºâ
                            try {
                                cookiesList = JSON.parse(cookieStr);
                            } catch (parseError) {
                                console.error('È¶ñÊ¨°JSONËß£ÊûêÂ§±Ë¥•ÔºåÂ∞ùËØï‰øÆÂ§çÊ†ºÂºè:', parseError);
                                
                                // Â∞ùËØïÁÆÄÂåñÂ§ÑÁêÜÔºöÂè™ÊèêÂèñÁ¨¨‰∏Ä‰∏™Êï∞ÁªÑÂÖÉÁ¥†Êàñ‰ΩøÁî®Ê≠£ÂàôÊèêÂèñcookieÊï∞ÊçÆ
                                // ‰æãÂ¶ÇÔºåÊâæÂà∞Á¨¨‰∏Ä‰∏™ÂÆåÊï¥ÁöÑÊï∞ÁªÑÂØπ
                                const arrayMatch = cookieStr.match(/\[\[.*?\]\]/s);
                                if (arrayMatch) {
                                    console.log('Â∞ùËØï‰ΩøÁî®Ê≠£ÂàôÊèêÂèñÁöÑÊï∞ÁªÑÈÉ®ÂàÜËøõË°åËß£Êûê');
                                    cookiesList = JSON.parse(arrayMatch[0]);
                                } else {
                                    throw new Error('Êó†Ê≥ïÊèêÂèñÊúâÊïàÁöÑJSONÊï∞ÁªÑ');
                                }
                            }
                        } else {
                            cookiesList = event.data.cookies;
                        }
                        
                        // Á°Æ‰øùcookiesListÊòØÊï∞ÁªÑ
                        if (!Array.isArray(cookiesList)) {
                            cookiesList = [cookiesList];
                        }
                        
                        // ÊâÅÂπ≥ÂåñcookieÊï∞ÁªÑ
                        const flatCookies = cookiesList.flat();
                        console.log('ÊàêÂäüËß£ÊûêÂπ∂ÊâÅÂπ≥ÂåñcookieÔºåÊï∞Èáè:', flatCookies.length);
                        
                        // Âè™‰øùÁïôÊúâÊïàÁöÑcookieÂØπË±°
                        const validCookies = flatCookies.filter(cookie => 
                            cookie && typeof cookie === 'object' && cookie.name && cookie.value
                        );
                        
                        if (validCookies.length > 0) {
                                const domain = new URL(targetUrl).hostname;
                                
                                // Ê≥®ÂÖ•cookiesÊó∂Ôºå‰ΩøÁî®baidu.com‰Ωú‰∏∫‰∏ªË¶ÅdomainÔºåÁ°Æ‰øùË∑®Â≠êÂüüÂêçÁöÑcookieÈÉΩËÉΩÊ≠£Á°ÆÊ≥®ÂÖ•
                                // ÂêåÊó∂‰º†ÈÄíÂéüÂßãdomain‰Ωú‰∏∫ÂèÇËÄÉ
                                return window.electronAPI.setCookies({
                                    targetUrl: `https://baijiahao.baidu.com`,
                                    cookies: validCookies,
                                    domain: 'baidu.com',
                                    partition: `persist:account_${event.data.accountId}`
                                }).then(resolve).catch(reject);
                            } else {
                                console.warn('Êú™ÊâæÂà∞ÊúâÊïàÁöÑcookieÂØπË±°ÔºåË∑≥ËøáÊ≥®ÂÖ•');
                                resolve();
                            }
                    } catch (error) {
                        console.error('Ëß£Êûêevent.data.cookiesÂ§±Ë¥•:', error);
                        resolve(); // Ëß£ÊûêÂ§±Ë¥•ÔºåÁªßÁª≠ÊâßË°å
                    }
                });
            } 
            // 2. Â¶ÇÊûúevent.data.cookies‰∏çÂ≠òÂú®ÊàñËß£ÊûêÂ§±Ë¥•ÔºåÂ∞ùËØïËé∑ÂèñÂ∑≤‰øùÂ≠òÁöÑË¥¶Âè∑cookie
            else {
                console.log('%cgetAccountStatus->>>>', 'color: red; font-weight: bold;', event.data)
                cookiePromise = window.electronAPI.getAccountStatus({
                    userId: event.data.sendId,
                    type: event.data.menuId
                }).then(result => {
                    console.log("%cgetAccountStatusÁöÑÁªìÊûú:", 'color: green; font-weight: bold;')
                    console.log(result)
                    if (result.success && result.accounts && result.accounts.length > 0) {
                        // Êü•ÊâæÂåπÈÖçÁöÑË¥¶Âè∑
                        const matchedAccount = result.accounts.find(acc => {
                            // Ê†πÊçÆpositionÂåπÈÖçË¥¶Âè∑
                            return acc.position === event.data.position;
                        });
                        
                        if (matchedAccount) {
                            try {
                                const savedCookies = JSON.parse(matchedAccount.cookies);
                                if (savedCookies && savedCookies.length > 0) {
                                    console.log('‰ªéauth/accountsËé∑ÂèñÂà∞cookieÔºåÊï∞Èáè:', savedCookies.length);
                                    const domain = new URL(targetUrl).hostname;
                                    return window.electronAPI.setCookies({
                                        targetUrl: targetUrl,
                                        cookies: savedCookies,
                                        domain: domain,
                                        partition: `persist:account_${event.data.accountId}`
                                    });
                                }else{
                                    console.log("%cÊú™ÊãøÂà∞cookie,Ê∏ÖÁ©∫ÁºìÂ≠ò", 'color: red; font-weight: bold;')
                                    window.electronAPI.clearCookies({
                                        partition: `persist:account_${event.data.accountId}`
                                    });
                                    return
                                }
                            } catch (parseError) {
                                console.error('Ëß£ÊûêcookieÂ§±Ë¥•:', parseError);
                            }
                        }
                    }
                    return Promise.resolve();
                }).catch(error => {
                    console.error('‰ªéauth/accountsËé∑ÂèñË¥¶Âè∑‰ø°ÊÅØÂ§±Ë¥•:', error);
                    return Promise.resolve();
                });
            }
            
            // 3. ÊâßË°åcookieÊ≥®ÂÖ•Âπ∂Âä†ËΩΩURL
            cookiePromise.then(() => {
                console.log('cookieÂ§ÑÁêÜÂÆåÊàêÔºåÂáÜÂ§áÂä†ËΩΩURL');
                
                // ÈáçÁÇπÔºöÁ°Æ‰øùcookieÂú®webviewÂä†ËΩΩURL‰πãÂâçÂÆåÊàêÊ≥®ÂÖ•
                // 1. È¶ñÂÖàËé∑ÂèñÂÖ≥ÈîÆcookieÔºåÈ™åËØÅÊòØÂê¶ÊàêÂäüÊ≥®ÂÖ•
                const keyCookies = ['BDUSS', 'BDUSS_BFESS', 'BAIDUID', 'BAIDUID_BFESS', 'bjhStoken'];
                
                // ÂêåÊó∂Ëé∑Âèñ.baidu.comÂíåbaijiahao.baidu.comÂüüÂêç‰∏ãÁöÑÊâÄÊúâcookie
                Promise.all([
                    window.electronAPI.getCookies(
                        'https://baijiahao.baidu.com', 
                        `persist:account_${event.data.accountId}`
                    ),
                    window.electronAPI.getCookies(
                        'https://baidu.com', 
                        `persist:account_${event.data.accountId}`
                    )
                ]).then(([baijiahaoCookies, baiduCookies]) => {
                    // ÂêàÂπ∂ÊâÄÊúâcookieÂπ∂ÂéªÈáç
                    const allCookies = [...baijiahaoCookies, ...baiduCookies].filter((cookie, index, self) => 
                        index === self.findIndex((c) => c.name === cookie.name && c.domain === cookie.domain)
                    );
                    
                    console.log('Ê≥®ÂÖ•ÂêéËé∑ÂèñÂà∞ÁöÑÂÖ®ÈÉ®cookie:', allCookies.length);
                    console.log('ÊâÄÊúâcookieËØ¶ÊÉÖ:', allCookies);
                    
                    // Ê£ÄÊü•ÂÖ≥ÈîÆcookieÊòØÂê¶Â≠òÂú®
                    const foundKeyCookies = keyCookies.filter(key => 
                        allCookies.some(cookie => cookie.name === key)
                    );
                    console.log('ÊàêÂäüÊ≥®ÂÖ•ÁöÑÂÖ≥ÈîÆcookie:', foundKeyCookies);
                    
                    // Ê£ÄÊü•Áº∫Â§±ÁöÑÂÖ≥ÈîÆcookie
                    const missingKeyCookies = keyCookies.filter(key => 
                        !allCookies.some(cookie => cookie.name === key)
                    );
                    if (missingKeyCookies.length > 0) {
                        console.log('Áº∫Â§±ÁöÑÂÖ≥ÈîÆcookie:', missingKeyCookies);
                    }
                    
                    // 2. Áé∞Âú®Âä†ËΩΩURL
                    newWebview.src = targetUrl;
                }).catch(error => {
                    console.error('Ëé∑ÂèñÊ≥®ÂÖ•ÂêéÁöÑcookieÂ§±Ë¥•:', error);
                    // Âç≥‰ΩøËé∑ÂèñcookieÂ§±Ë¥•Ôºå‰ªçÁªßÁª≠Âä†ËΩΩURL
                    newWebview.src = targetUrl;
                });
            }).catch(error => {
                console.error('cookieÊ≥®ÂÖ•ËøáÁ®ã‰∏≠Âá∫Áé∞ÈîôËØØ:', error);
                newWebview.src = targetUrl; // ‰ªª‰ΩïÈîôËØØÈÉΩÁªßÁª≠Âä†ËΩΩURL
            });
          }
        }
        if (event.data.type === "openWenxinAuth") {
          // ÊâìÂºÄÊñáÂøÉÊô∫ËÉΩ‰ΩìÊéàÊùÉÈ°µÈù¢
          console.log("ÊâìÂºÄÊñáÂøÉÊô∫ËÉΩ‰ΩìÊéàÊùÉÈ°µÈù¢")
          window.electronAPI.openUrlInNewWindow({
            url: event.data.url,
            partition: `persist:wenxin_${event.data.accountId}`,
            acc_id: event.data.accountId,
          });
          
        }
      });

      function showLoading() {
        const loadingOverlay = document.getElementById("loadingOverlay");
        loadingOverlay.classList.add("show");
      }

      function hideLoading() {
        const loadingOverlay = document.getElementById("loadingOverlay");
        loadingOverlay.classList.remove("show");
      }

      function checkLoginStatus(url) {
        console.log("---È™åËØÅurl", url);
        // console.log("Ëé∑ÂèñÂà∞ÁöÑÊï∞ÊçÆÊòØÔºö", navItems);
        const a = navItems.find((item) => item.id === currentNavId);
        console.log("-----a------", a);
        
        // Ëé∑ÂèñÂΩìÂâçË¥¶Âè∑‰ΩçÁΩÆ‰ø°ÊÅØÔºàÈªòËÆ§‰ªéwindowÂØπË±°Ëé∑ÂèñÔºåÁî±hubÈ°µÈù¢‰º†ÈÄíÔºâ
        const currentPosition = window.currentAccountPosition || 1;
        // Ëé∑ÂèñÂΩìÂâçwebviewÁöÑpartition
        const webview = document.getElementById("browserView");
        const accountId = window.currentAccountId || webview.getAttribute('data-account-id');
        const partition = accountId ? `persist:account_${accountId}` : null;
        
        // ÁôæÂÆ∂Âè∑ÁôªÂΩïÊµÅÁ®ãÔºö‰æùÊ¨°ËÆøÈóÆ‰∏â‰∏™ÂÖ≥ÈîÆÂüüÂêçËé∑ÂèñÂÆåÊï¥cookie
        // 1. Á¨¨‰∏ÄÊ≠•ÔºöÁôæÂÆ∂Âè∑È¶ñÈ°µ
        if (url.includes('baijiahao.baidu.com/builder/rc/home') && a && !a.flag) {
          // ÂàùÂßãÂåñcookiesList‰∏∫Á©∫Êï∞ÁªÑ
          cookiesList = [];
          try {
            res = window.electronAPI.getCookies('https://baijiahao.baidu.com', partition);
            res.then((result) => {
              cookiesList.push(result);
              console.log('%cÁôæÂÆ∂Âè∑->>>>', 'color: red; font-weight: bold;', cookiesList);
              const webview = document.getElementById('browserView');
              setTimeout(() => {
                webview.src = "https://passport.baidu.com/";
              }, 2000);
            });
          } catch (error) {
            console.error('Ëé∑ÂèñÁôæÂÆ∂Âè∑È¶ñÈ°µcookieÂ§±Ë¥•:', error);
          }
        }
        
        // 2. Á¨¨‰∫åÊ≠•ÔºöÁôæÂ∫¶ÁôªÂΩïÈ°µ
        if (url.includes('https://passport.baidu.com/v6/ucenter') && a && !a.flag) {
          try {
            res = window.electronAPI.getCookies('https://passport.baidu.com', partition);
            res.then((result) => {
              cookiesList.push(result);
              console.log('%cÁôæÂ∫¶->>>>', 'color: red; font-weight: bold;', cookiesList);
              const webview = document.getElementById('browserView');
              setTimeout(() => {
                webview.src = "https://agents.baidu.com/";
              }, 2000);
            });
          } catch (error) {
            console.error('Ëé∑ÂèñÁôæÂ∫¶ÁôªÂΩïÈ°µcookieÂ§±Ë¥•:', error);
          }
        }
        
        // 3. Á¨¨‰∏âÊ≠•ÔºöÁôæÂ∫¶Êô∫ËÉΩ‰ΩìÂπ≥Âè∞ÔºàÊúÄÁªàÁôªÂΩïÊàêÂäüÔºâ
        if (url.includes('agents.baidu.com/center') && a && !a.flag) {
            console.log("hubËß¶ÂèëË∞ÉÁî®mainËøõÁ®ã");
            // ‰ªé iframe Ëé∑Âèñ‰º†ÈÄíËøáÊù•ÁöÑ acc_id
            const iframe = document.getElementById("hubFrame");
            let acc_id = null;
            try {
              const hubContent = iframe.contentWindow;
              if (hubContent && hubContent.currentAccountId) acc_id = hubContent.currentAccountId;
            } catch (e) {
              console.log("Êó†Ê≥ï‰ªéhubËé∑ÂèñË¥¶Êà∑‰ø°ÊÅØ");
            }
            // ‰ΩøÁî®‰πãÂâç‰øùÂ≠òÁöÑisMainÂÄºÔºåÁ°Æ‰øù‰∏ªË¥¶Âè∑Ê†áËØÜÊ≠£Á°Æ
            let isMain = window.currentAccountIsMain || 0;
            console.log('‰ΩøÁî®ÁöÑÂèÇÊï∞type‰∏∫', currentNavId);
            console.log('‰ΩøÁî®ÁöÑcurrentPosition‰∏∫', currentPosition);
            res = window.electronAPI.getCookies('https://agents.baidu.com/', partition);
            res.then((result) => {
              cookiesList.push(result);
              console.log('%cÊô∫ËÉΩ‰Ωì->>>>', 'color: red; font-weight: bold;', cookiesList);
              const result1 = window.electronAPI.saveUserCookies({
                    currentNavId,
                    cookiesList,
                    token,
                    sendId,
                    position: currentPosition,
                    isMain: isMain
                });
                // È™åËØÅcookie‰ø°ÊÅØ
                const result2 = window.electronAPI.checkUserCookies({
                    currentNavId,
                    cookiesList,
                    token,
                    sendId,
                    acc_id: acc_id,
                    position: currentPosition,
                    is_main: isMain,
                    // type: currentNavId // Ê∑ªÂä†Áº∫Â∞ëÁöÑtypeÂ≠óÊÆµÔºå‰ΩøÁî®currentNavId‰Ωú‰∏∫typeÂÄº
                });
            });
            // ‰øùÂ≠òcookie‰ø°ÊÅØ - ‰ΩøÁî®‰πãÂâçÊ≠£Á°ÆËÆæÁΩÆÁöÑcurrentPositionÔºåËÄå‰∏çÊòØ‰ªéhubFrameÈáçÊñ∞Ëé∑Âèñ
            
            a.flag = true;
            setTimeout(() => {
              console.log("Ë∑≥ËΩ¨ÂõûÁôæÂÆ∂Âè∑È¶ñÈ°µ");
              webview.src = "https://baijiahao.baidu.com/builder/rc/home";
            }, 5000);
            showSuccessMessage("ÁôªÂΩïÊàêÂäü");
            // });

            // ÊâÄÊúâÂπ≥Âè∞ÊéàÊùÉÊàêÂäüÔºåÈÄöÁü• hub È°µÈù¢Âà∑Êñ∞
            const hubFrame = document.getElementById("hubFrame");
            if (hubFrame && hubFrame.contentWindow) {
              hubFrame.contentWindow.postMessage({
                type: "accountAuthorized",
                menuId: currentNavId,
                userId: sendId
              }, "*");
            }
          // });
        }
        if (url.includes("https://mp.sohu.com/mpfe/v4/contentManagement/first/page") &&a && !a.flag ) {
          res = window.electronAPI.getCookies("https://mp.sohu.com", partition);
          res.then((result) => {
            cookiesList = [];
            cookiesList.push(result);
            // ‰øùÂ≠òcookie‰ø°ÊÅØ
            const result1 = window.electronAPI.saveUserCookies({
              currentNavId,
              cookiesList,
              token,
              sendId,
              // acc_id: getCurrentAccountId()
              position: currentPosition,
              isMain: window.currentAccountIsMain || 0,
              // type: currentNavId // Ê∑ªÂä†Áº∫Â∞ëÁöÑtypeÂ≠óÊÆµÔºå‰ΩøÁî®currentNavId‰Ωú‰∏∫typeÂÄº
            });
            // È™åËØÅcookie‰ø°ÊÅØ
            const result2 = window.electronAPI.checkUserCookies({
              currentNavId,
              cookiesList,
              token,
              sendId,
              // acc_id: getCurrentAccountId()
              position: currentPosition,
              isMain: window.currentAccountIsMain || 0,
              // type: currentNavId // Ê∑ªÂä†Áº∫Â∞ëÁöÑtypeÂ≠óÊÆµÔºå‰ΩøÁî®currentNavId‰Ωú‰∏∫typeÂÄº
            });
            a.flag = true;
          });
          showSuccessMessage("ÁôªÂΩïÊàêÂäü");
          
        }
        if ((url.includes("https://mp.toutiao.com/profile_v4/index") ||"profile_v4/index".includes(url)) &&a &&!a.flag) {
          res = window.electronAPI.getCookies("https://mp.toutiao.com", partition);
          res.then((result) => {
            cookiesList = [];
            cookiesList.push(result);
            // ‰øùÂ≠òcookie‰ø°ÊÅØ
            const result1 = window.electronAPI.saveUserCookies({
              currentNavId,
              cookiesList,
              token,
              sendId,
              position: currentPosition,
              // type: currentNavId // Ê∑ªÂä†Áº∫Â∞ëÁöÑtypeÂ≠óÊÆµÔºå‰ΩøÁî®currentNavId‰Ωú‰∏∫typeÂÄº
            });
            // È™åËØÅcookie‰ø°ÊÅØ
            const result2 = window.electronAPI.checkUserCookies({
              currentNavId,
              cookiesList,
              token,
              sendId,
              position: currentPosition,
              // type: currentNavId // Ê∑ªÂä†Áº∫Â∞ëÁöÑtypeÂ≠óÊÆµÔºå‰ΩøÁî®currentNavId‰Ωú‰∏∫typeÂÄº
            });
            a.flag = true;
          });
          showSuccessMessage("ÁôªÂΩïÊàêÂäü");
        }
        if (url.includes("https://mp.sina.com.cn/#") && a && !a.flag) {
          res = window.electronAPI.getCookies("https://mp.sina.com.cn", partition);
          res.then((result) => {
            cookiesList = [];
            cookiesList.push(result);

            // ‰øùÂ≠òcookie‰ø°ÊÅØ
            const result1 = window.electronAPI.saveUserCookies({
              currentNavId,
              cookiesList,
              token,
              sendId,
              position: currentPosition,
              // type: currentNavId // Ê∑ªÂä†Áº∫Â∞ëÁöÑtypeÂ≠óÊÆµÔºå‰ΩøÁî®currentNavId‰Ωú‰∏∫typeÂÄº
            });
            const result2 = window.electronAPI.checkUserCookies({
              currentNavId,
              cookiesList,
              token,
              sendId,
              position: currentPosition,
              // type: currentNavId // Ê∑ªÂä†Áº∫Â∞ëÁöÑtypeÂ≠óÊÆµÔºå‰ΩøÁî®currentNavId‰Ωú‰∏∫typeÂÄº
            });
            a.flag = true;
          });
          showSuccessMessage("ÁôªÂΩïÊàêÂäü");
        }
        if (url.includes("https://om.qq.com/main") && a && !a.flag) {
          res = window.electronAPI.getCookies("https://om.qq.com", partition);
          res.then((result) => {
            cookiesList = [];
            cookiesList.push(result);
            // ‰øùÂ≠òcookie‰ø°ÊÅØ
            const result1 = window.electronAPI.saveUserCookies({
              currentNavId,
              cookiesList,
              token,
              sendId,
              position: currentPosition,
              // type: currentNavId // Ê∑ªÂä†Áº∫Â∞ëÁöÑtypeÂ≠óÊÆµÔºå‰ΩøÁî®currentNavId‰Ωú‰∏∫typeÂÄº
            });
            const result2 = window.electronAPI.checkUserCookies({
              currentNavId,
              cookiesList,
              token,
              sendId,
              position: currentPosition,
              isMain: window.currentAccountIsMain || 0
            });
            
            // ‰ΩøÁî®Promise.allË∑üË∏™ÁªìÊûú
            Promise.all([result1, result2]).then((results) => {
              console.log('saveUserCookiesÁªìÊûú:', results[0]);
              console.log('checkUserCookiesÁªìÊûú:', results[1]);
            });
            
            a.flag = true;
            a.flag = true;
          });
          showSuccessMessage("ÁôªÂΩïÊàêÂäü");
        }
        // ÁΩëÊòìÂπ≥Âè∞ÁôªÂΩïÊàêÂäüÂ§ÑÁêÜ
        if (url.includes("https://mp.163.com/login.html#/") && a && !a.flag) {
          res = window.electronAPI.getCookies("https://mp.163.com", partition);
          console.log("ËøõÂÖ•Âà∞ÁΩëÊòìÂπ≥Âè∞ÁôªÂΩïÊàêÂäüÂ§ÑÁêÜ");
          res.then((result) => {
            cookiesList = [];
            console.log("Ëé∑ÂèñÂà∞ÁöÑcookies:", result);
            if (result && Array.isArray(result)) {
              cookiesList.push(result); // ‰ΩøÁî®spreadËøêÁÆóÁ¨¶ÊâÅÂπ≥ÂåñÊï∞ÁªÑ
            }
            
            cookiesList.push(result);
            // ‰øùÂ≠òcookie‰ø°ÊÅØ
            const result1 = window.electronAPI.saveUserCookies({
              currentNavId,
              cookiesList,
              token,
              sendId,
              position: currentPosition,
              // type: currentNavId // Ê∑ªÂä†Áº∫Â∞ëÁöÑtypeÂ≠óÊÆµÔºå‰ΩøÁî®currentNavId‰Ωú‰∏∫typeÂÄº
            });
            const result2 = window.electronAPI.checkUserCookies({
              currentNavId,
              cookiesList,
              token,
              sendId,
              position: currentPosition,
              isMain: window.currentAccountIsMain || 0
            });
            
            a.flag = true;
            showSuccessMessage("ÁôªÂΩïÊàêÂäü");
            
            // ÈÄöÁü• hub È°µÈù¢Âà∑Êñ∞Ë¥¶Âè∑Áä∂ÊÄÅ
            const hubFrame = document.getElementById("hubFrame");
            if (hubFrame && hubFrame.contentWindow) {
              hubFrame.contentWindow.postMessage({
                type: "accountAuthorized",
                menuId: currentNavId,
                userId: sendId
              }, "*");
            }
          });
        }
        if (url.includes("http://zs.open.chuangmaedu.com/openPlatform/callback") && a && !a.flag ) {
          res = window.electronAPI.getCookies(
            "http://zs.open.chuangmaedu.com",
            partition
          );
          res.then((result) => {
            cookiesList = [];
            cookiesList.push(result);
            
            // ‰ªé iframe Ëé∑Âèñ‰º†ÈÄíËøáÊù•ÁöÑ acc_id Á≠â‰ø°ÊÅØ
            const iframe = document.getElementById("hubFrame");
            let acc_id = null;
            let position = 1;
            let isMain = 0;
            try {
              const hubContent = iframe.contentWindow;
              if (hubContent && hubContent.currentAccountId) acc_id = hubContent.currentAccountId;
              if (hubContent && hubContent.currentAccount) {
                position = hubContent.currentAccount.position || 1;
                isMain = hubContent.currentAccount.isMain || 0;
              }
            } catch (e) {
              console.log("Êó†Ê≥ï‰ªéhubËé∑ÂèñË¥¶Êà∑‰ø°ÊÅØ");
            }
            
            // ‰øùÂ≠òcookie‰ø°ÊÅØ
            const result1 = window.electronAPI.saveUserCookies({
              currentNavId,
              cookiesList,
              token,
              sendId,
              acc_id: acc_id,
              position: position,
              is_main: isMain
            });
            
            // È™åËØÅcookie‰ø°ÊÅØ
            const result2 = window.electronAPI.checkUserCookies({
              currentNavId,
              cookiesList,
              token,
              sendId,
              acc_id: acc_id,
              position: position,
              is_main: isMain
            });
            a.flag = true;
            showSuccessMessage("ÁôªÂΩïÊàêÂäü");
            
            // ÈÄöÁü• hub È°µÈù¢Âà∑Êñ∞Ë¥¶Âè∑Áä∂ÊÄÅ
            const hubFrame = document.getElementById("hubFrame");
            if (hubFrame && hubFrame.contentWindow) {
              hubFrame.contentWindow.postMessage({
                type: "accountAuthorized",
                menuId: currentNavId,
                userId: sendId
              }, "*");
            }
          });
        }
      }

      function showSuccessMessage(message) {
        const messageBox = document.createElement("div");
        messageBox.className = "message-box";
        messageBox.innerHTML = `
                <h3>‚úì ÊàêÂäü</h3>
                <p>${message}</p>
                <button onclick="this.parentElement.remove()">Á°ÆÂÆö</button>
            `;
        document.body.appendChild(messageBox);

        setTimeout(() => {
          if (messageBox.parentElement) {
            messageBox.remove();
          }
        }, 3000);
      }

      function updateAuthorization() {
        console.log("ÂºÄÂßãÊõ¥Êñ∞ÊéàÊùÉ...");
        // Á°Æ‰øù currentPosition Â∑≤ÂÆö‰πâ
        let currentPosition;
        if (typeof window.currentAccountPosition !== 'undefined') {
          currentPosition = window.currentAccountPosition;
        } else {
          currentPosition = 0; // ËÆæÁΩÆÈªòËÆ§ÂÄº
        }
        console.log("ÂΩìÂâçË¥¶Âè∑‰ΩçÁΩÆ:", currentPosition);
        showLoading();
        
        const webview = document.getElementById("browserView");
        const currentUrl = webview.getURL();
        
        // Ëé∑ÂèñÂΩìÂâçÂØºËà™È°πÔºåÈáçÁΩÆflag‰ª•‰æøÈáçÊñ∞ÊâßË°åÊéàÊùÉÊµÅÁ®ã
        const a = navItems.find((item) => item.id === currentNavId);
        if (a) {
          a.flag = false; // ÈáçÁΩÆflagÔºåÂÖÅËÆ∏ÈáçÊñ∞ÊâßË°åÊéàÊùÉÊµÅÁ®ã
          console.log("Â∑≤ÈáçÁΩÆÂØºËà™È°πflag‰∏∫false:", a);
        }
        
        // Â§ÑÁêÜÁôæÂÆ∂Âè∑ÁâπÊÆäÊéàÊùÉÊµÅÁ®ãÔºåÈúÄË¶ÅË∑≥ËΩ¨‰∏â‰∏™È°µÈù¢
        if (currentUrl.includes("baijiahao.baidu.com")) {
          // Áõ¥Êé•Ë∑≥ËΩ¨Âà∞ÁôæÂ∫¶ÁôªÂΩïÈ°µÔºåÂêØÂä®ÂÆåÊï¥ÁöÑ‰∏âÈ°µÈù¢ÊéàÊùÉÊµÅÁ®ã
           // Ëß¶ÂèëËé∑ÂèñÈ¶ñÈ°µcookie
          console.log("ÂêØÂä®ÁôæÂÆ∂Âè∑ÂÆåÊï¥ÊéàÊùÉÊµÅÁ®ã");
          // webview.src = "https://passport.baidu.com/";
          cookiesList = [];
          webview.src = "https://baijiahao.baidu.com/builder/rc/home";
          // webview.src = "https://agents.baidu.com/";
          // checkLoginStatus(currentUrl);
          hideLoading();
          showSuccessMessage("Â∑≤ÂêØÂä®ÊéàÊùÉÊµÅÁ®ãÔºåËØ∑Á≠âÂæÖÈ°µÈù¢Ë∑≥ËΩ¨ÂÆåÊàê");
          return;
        } 
        
        // ÂÖ∂‰ªñÂπ≥Âè∞‰øùÊåÅÂéüÊúâÈÄªËæëÔºåÁõ¥Êé•Ëé∑ÂèñÂΩìÂâçÈ°µÈù¢cookie
        let domain = "";
        if (currentUrl.includes("mp.sohu.com")) {
          domain = "https://mp.sohu.com";
        } else if (currentUrl.includes("mp.toutiao.com")) {
          domain = "https://mp.toutiao.com";
        } else if (currentUrl.includes("mp.sina.com.cn")) {
          domain = "https://mp.sina.com.cn";
        } else if (currentUrl.includes("om.qq.com")) {
          domain = "https://om.qq.com";
        } else if (currentUrl.includes("post.smzdm.com")) {
          domain = "https://post.smzdm.com";
        } else if (currentUrl.includes("mp.163.com")) {
          domain = "https://mp.163.com";
        } else {
          hideLoading();
          showSuccessMessage("ÂΩìÂâçÈ°µÈù¢‰∏çÊîØÊåÅÊõ¥Êñ∞ÊéàÊùÉ");
          return;
        }
        
        // Ëé∑ÂèñÂΩìÂâçË¥¶Âè∑‰ø°ÊÅØÔºåÁî®‰∫éÊûÑÂª∫partition
        const accountId = window.currentAccountId || webview.getAttribute('data-account-id');
        const partition = accountId ? `persist:account_${accountId}` : null;
        console.log("‰ΩøÁî®ÁöÑpartition:", partition, "accountId:", accountId);
        
        window.electronAPI
          .getCookies(domain, partition)
          .then((result) => {
            console.log("Ëé∑ÂèñÂà∞ÁöÑcookies:", result);
            // const result2 = window.electronAPI.checkUserCookies({
            //   currentNavId,
            //   cookiesList: result,
            //   token,
            //   sendId,
            //   position: currentPosition,
            //   // type: currentNavId // Ê∑ªÂä†Áº∫Â∞ëÁöÑtypeÂ≠óÊÆµÔºå‰ΩøÁî®currentNavId‰Ωú‰∏∫typeÂÄº
            // });
            
            // ÂàùÂßãÂåñcookiesListÂèòÈáè
            // const cookiesList = result
            // ‰øùÂ≠òcookie‰ø°ÊÅØ
            // const result1 = window.electronAPI.saveUserCookies({
            //   currentNavId,
            //   cookiesList: result,
            //   token,
            //   sendId,
            //   acc_id: accountId,
            //   position: currentPosition,
            //   is_main: window.currentAccountIsMain || 0
            // });
            
            
            // È™åËØÅcookie‰ø°ÊÅØ
            const result2 = window.electronAPI.checkUserCookies({
              currentNavId,
              cookiesList: result,
              token,
              sendId,
              acc_id: accountId,
              position: currentPosition,
              is_main: window.currentAccountIsMain || 0
            });
            console.log("checkUserCookiesÁªìÊûú:", result2);
            hideLoading();
            showSuccessMessage("ÊéàÊùÉÊõ¥Êñ∞ÊàêÂäü");
          })
          .catch((error) => {
            console.error("Êõ¥Êñ∞ÊéàÊùÉÂ§±Ë¥•:", error);
            hideLoading();
            showSuccessMessage("ÊéàÊùÉÊõ¥Êñ∞Â§±Ë¥•ÔºåËØ∑ÈáçËØï");
          });
      }

      function setupNavigationListener(callback) {
        window.addEventListener("hashchange", () =>
          callback({
            type: "hashchange",
            url: window.location.href,
          })
        );
        window.addEventListener("locationchange", (e) =>
          callback({
            type: e.detail.method,
            url: e.detail.url,
          })
        );
        window.addEventListener("load", () =>
          callback({
            type: "load",
            url: window.location.href,
          })
        );
      }

      setupNavigationListener((event) => {
        console.log("Navigation event:", event);
      });

      function sendUrl() {
        const data = {
          type: currentNavId,
          json_str: JSON.stringify(cookiesList),
          time: Math.floor(Date.now() / 1000).toString(),
          send_id: sendId,
        };
        const headers = {
          "Content-Type": "application/json",
        };
        fetch(checkUrl + "/desktop/check/sign/", {
          method: "POST",
          headers: headers,
          body: JSON.stringify(data),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then((data) => {
            console.log("data:", data);
            return data;
          })
          .catch((error) => {
            console.error("ËØ∑Ê±ÇÂ§±Ë¥•:", error);
            return null;
          });
      }
    </script>
  </body>
</html>